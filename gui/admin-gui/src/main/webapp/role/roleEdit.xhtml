<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition template="/resources/templates/template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:comp="http://java.sun.com/jsf/composite/components" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ice="http://www.icesoft.com/icefaces/component" xmlns:ace="http://www.icefaces.org/icefaces/components"
	xmlns:idm="http://midpoint.evolveum.com/xml/ns/custom-taglib/">

	<ui:define name="title">
		<f:subview rendered="#{not roleEdit.newRole}">#{msg['page.role.roleEdit.title']}</f:subview>
		<f:subview rendered="#{roleEdit.newRole}">#{msg['page.role.roleEdit.title.create']}</f:subview>
	</ui:define>

	<ui:define name="menu">
		<ui:include src="./menu.xhtml" />
	</ui:define>

	<ui:define name="content">
		<comp:browser okAction="#{roleEdit.assignmentEditor.okBrowseAction}" cancelAction="#{roleEdit.assignmentEditor.cancelBrowseAction}"
			bean="#{roleEdit.assignmentEditor.browser}" show="#{roleEdit.assignmentEditor.showBrowser}" allowTypeSearch="false"/>
		<comp:xmlEditor okAction="#{roleEdit.okEditorAction}" cancelAction="#{roleEdit.assignmentEditor.cancelEditAction}"
			bean="#{roleEdit.assignmentEditor.editor}" show="#{roleEdit.assignmentEditor.showEditor}" />
		<ice:form>
			<ice:panelGrid columns="3" cellpadding="3" cellspacing="3">
				<ice:outputLabel value="Name" />
				<ice:inputText id="name" value="#{roleEdit.role.name}" required="true" />
				<ice:message for="name" />

				<ice:outputLabel value="Description" />
				<ice:inputTextarea id="description" value="#{roleEdit.role.description}" />
				<ice:message for="description" />
			</ice:panelGrid>
			<h3 style="margin-top: 10px;">Assignments</h3>
			<ice:dataTable rows="20"
						value="#{userDetails.assignmentEditor.containsAssignment.assignments}"
						var="item" columnWidths="auto, auto, auto" resizable="false">
						<ice:column>
							<f:facet name="header">
								<ice:selectBooleanCheckbox id="selectAllCheckbox"
									value="#{userDetails.assignmentEditor.selectAll}"
									valueChangeListener="#{userDetails.assignmentEditor.selectAllPerformed}"
									immediate="true" partialSubmit="true"
									 />
							</f:facet>
							<ice:selectBooleanCheckbox id="selectCheckbox"
								value="#{item.selected}" partialSubmit="true" immediate="true"
								valueChangeListener="#{userDetails.assignmentEditor.selectPerformed}"
								 />
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="Type" />
							</f:facet>
							<ice:outputText value="#{item.objectTypeString}" />
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="Name" />
							</f:facet>
							<ice:outputText value="#{item.objectString}" />
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="Description" />
							</f:facet>
							<ice:outputText value="#{item.description}" />
						</ice:column>
					</ice:dataTable>
					<idm:button
						action="#{userDetails.assignmentEditor.showBrowserPerformed}"
						buttonType="positive" immediate="true" value="Add role"
						img="/resources/images/user_add.png" >
					</idm:button>
					<idm:button
								action="#{userDetails.assignmentEditor.deleteAssignments}"
								buttonType="negative" immediate="true"
								value="#{msg['page.button.deleteAssignments']}" />
								<ui:remove>
			<ice:dataTable rows="20" value="#{roleEdit.assignmentEditor.containsAssignment.assignments}" var="item"
				columnWidths="auto, auto, auto, auto, auto, auto, auto" resizable="false">
				<ice:column>
					<f:facet name="header">
						<ice:selectBooleanCheckbox id="selectAllCheckbox" value="#{roleEdit.assignmentEditor.selectAll}"
							valueChangeListener="#{roleEdit.assignmentEditor.selectAllPerformed}" immediate="true"
							partialSubmit="true" />
					</f:facet>
					<ice:selectBooleanCheckbox id="selectCheckbox" value="#{item.selected}" partialSubmit="true"
						immediate="true" valueChangeListener="#{roleEdit.assignmentEditor.selectPerformed}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.assignmentType']}" />
					</f:facet>
					<ice:commandLink style="text-decoration: underline;" value="#{item.typeString}"
						action="#{roleEdit.assignmentEditor.editAssignment}" rendered="#{!(item.editing)}" immediate="true">
						<f:param name="assignmentId" value="#{item.id}" />
					</ice:commandLink>
					<ice:selectOneMenu value="#{item.typeString}" rendered="#{(item.editing)}" immediate="true"
						partialSubmit="true">
						<f:selectItems value="#{roleEdit.assignmentEditor.assignmentTypes}" />
					</ice:selectOneMenu>
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.active']}" />
					</f:facet>
					<ice:selectBooleanCheckbox value="#{item.enabled}" disabled="#{!(item.editing)}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.object']}" />
					</f:facet>
					<ice:outputLabel value="#{item.objectString}" rendered="#{!(item.editing)}" />
					<ice:commandLink style="text-decoration: underline;" value="#{item.objectString}"
						action="#{roleEdit.assignmentEditor.editAssignmentObject}"
						rendered="#{item.editing}" immediate="true">
						<f:param name="assignmentId" value="#{item.id}" />
					</ice:commandLink>
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.useActivationDate']}" />
					</f:facet>
					<ice:selectBooleanCheckbox value="#{item.useActivationDate}" disabled="#{!(item.editing)}"
						immediate="true" partialSubmit="true" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.activeFrom']}" />
					</f:facet>
					<ice:outputLabel value="#{item.fromActivationString}" rendered="#{!(item.editing)}" />
					<ice:selectInputDate value="#{item.fromActivation}" renderMonthAsDropdown="true" renderAsPopup="true"
						renderYearAsDropdown="true" renderWeekNumbers="true" rendered="#{item.editing}" renderInputField="true"
						singleSubmit="false" disabled="#{!(item.useActivationDate)}">
						<f:convertDateTime pattern="MMM/dd/yyyy hh:mm a" />
					</ice:selectInputDate>
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.activeTo']}" />
					</f:facet>
					<ice:outputLabel value="#{item.toActivationString}" rendered="#{!(item.editing)}" />
					<ice:selectInputDate value="#{item.toActivation}" renderMonthAsDropdown="true" renderAsPopup="true"
						renderYearAsDropdown="true" renderWeekNumbers="true" rendered="#{item.editing}" renderInputField="true"
						singleSubmit="false" disabled="#{!(item.useActivationDate)}">
						<f:convertDateTime pattern="MMM/dd/yyyy hh:mm a" />
					</ice:selectInputDate>
				</ice:column>
			</ice:dataTable>

			<div style="margin-bottom: 5px;">
				<idm:button action="#{roleEdit.assignmentEditor.addAssignment}" value="#{msg['page.button.addAssignment']}"
					img="/resources/images/door_in.png" immediate="true" buttonType="positive" />

				<idm:button action="#{roleEdit.assignmentEditor.deleteAssignments}" buttonType="negative" immediate="true"
					value="#{msg['page.button.deleteAssignments']}" img="/resources/images/user_add.png" />
			</div>
</ui:remove>
			<div class="button-bar">
				<idm:button action="#{roleList.initController}" value="#{msg['page.button.cancel']}"
					img="/resources/images/door_in.png" id="cancelRoleCreate" immediate="true" />

				<idm:button actionListener="#{roleEdit.save}" action="#{roleList.initController}" id="createRole"
					buttonType="positive" value="#{msg['page.button.save']}" img="/resources/images/user_add.png" />
			</div>
		</ice:form>
	</ui:define>
</ui:composition>