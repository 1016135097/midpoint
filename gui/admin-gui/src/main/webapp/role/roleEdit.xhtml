<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition template="/resources/templates/template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:comp="http://java.sun.com/jsf/composite/components" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ice="http://www.icesoft.com/icefaces/component" xmlns:ace="http://www.icefaces.org/icefaces/components"
	xmlns:idm="http://midpoint.evolveum.com/xml/ns/custom-taglib/">

	<ui:define name="title">
		<f:subview rendered="#{not roleEdit.newRole}">#{msg['page.role.roleEdit.title']}</f:subview>
		<f:subview rendered="#{roleEdit.newRole}">#{msg['page.role.roleEdit.title.create']}</f:subview>
	</ui:define>

	<ui:define name="menu">
		<ui:include src="./menu.xhtml" />
	</ui:define>

	<ui:define name="content">
		<comp:browser okAction="#{roleEdit.okBrowseAction}" cancelAction="#{roleEdit.cancelBrowseAction}"
			bean="#{roleEdit.browser}" show="#{roleEdit.showBrowser}" />
		<comp:xmlEditor okAction="#{roleEdit.okEditorAction}" cancelAction="#{roleEdit.cancelEditAction}"
			bean="#{roleEdit.editor}" show="#{roleEdit.showEditor}" />
		<ice:form>
			<ice:panelGrid columns="3" cellpadding="3" cellspacing="3">
				<ice:outputLabel value="Name" />
				<ice:inputText id="name" value="#{roleEdit.role.name}" required="true" />
				<ice:message for="name" />

				<ice:outputLabel value="Description" />
				<ice:inputTextarea id="description" value="#{roleEdit.role.description}" />
				<ice:message for="description" />
			</ice:panelGrid>
			<h3 style="margin-top: 10px;">Assignments</h3>
			<ice:dataTable rows="20" value="#{roleEdit.role.assignments}" var="item"
				columnWidths="auto, auto, auto, auto, auto, auto, auto" resizable="false">
				<ice:column>
					<f:facet name="header">
						<ice:selectBooleanCheckbox id="selectAllCheckbox" value="#{roleEdit.selectAll}"
							valueChangeListener="#{roleEdit.selectAllPerformed}" immediate="true" partialSubmit="true" />
					</f:facet>
					<ice:selectBooleanCheckbox id="selectCheckbox" value="#{item.selected}" partialSubmit="true"
						immediate="true" valueChangeListener="#{roleEdit.selectPerformed}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.assignmentType']}" />
					</f:facet>
					<ice:commandLink style="text-decoration: underline;" value="#{item.typeString}"
						action="#{roleEdit.editAssignment}" rendered="#{not item.editing}" immediate="true">
						<f:param name="assignmentId" value="#{item.id}" />
					</ice:commandLink>
					<ice:selectOneMenu value="#{item.typeString}" rendered="#{item.editing}" immediate="true"
						partialSubmit="true">
						<f:selectItems value="#{roleEdit.assignmentTypes}" />
					</ice:selectOneMenu>
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.active']}" />
					</f:facet>
					<ice:selectBooleanCheckbox value="#{item.enabled}" disabled="#{not item.editing}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.object']}" />
					</f:facet>
					<ice:outputLabel value="#{item.objectString}" rendered="#{not item.editing}" />
					<ice:commandLink style="text-decoration: underline;" value="#{item.objectString}"
						action="#{roleEdit.editAssignmentObject}" rendered="#{item.editing}" immediate="true">
						<f:param name="assignmentId" value="#{item.id}" />
					</ice:commandLink>
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.useActivationDate']}" />
					</f:facet>
					<ice:selectBooleanCheckbox value="#{item.useActivationDate}" disabled="#{not item.editing}"
						immediate="true" partialSubmit="true" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.activeFrom']}" />
					</f:facet>
					<ice:outputLabel value="#{item.fromActivationString}" rendered="#{not item.editing}" />
					<ice:selectInputDate value="#{item.fromActivation}" renderMonthAsDropdown="true"  renderAsPopup="true"
						renderYearAsDropdown="true" renderWeekNumbers="true" rendered="#{item.editing}" renderInputField="true"
						singleSubmit="false" disabled="#{not item.useActivationDate}">
						<f:convertDateTime pattern="MMM/dd/yyyy hh:mm a" />
					</ice:selectInputDate>
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:outputLabel value="#{msg['page.role.roleEdit.table.activeTo']}" />
					</f:facet>
					<ice:outputLabel value="#{item.toActivationString}" rendered="#{not item.editing}" />
					<ice:selectInputDate value="#{item.toActivation}" renderMonthAsDropdown="true"  renderAsPopup="true"
						renderYearAsDropdown="true" renderWeekNumbers="true" rendered="#{item.editing}" renderInputField="true"
						singleSubmit="false" disabled="#{not item.useActivationDate}">
						<f:convertDateTime pattern="MMM/dd/yyyy hh:mm a" />
					</ice:selectInputDate>				
				</ice:column>
			</ice:dataTable>

			<div style="margin-bottom: 5px;">
				<idm:button action="#{roleEdit.addAssignment}" value="#{msg['page.button.addAssignment']}"
					img="/resources/images/door_in.png" immediate="true" buttonType="positive" />

				<idm:button action="#{roleEdit.deleteAssignments}" buttonType="negative" immediate="true"
					value="#{msg['page.button.deleteAssignments']}" img="/resources/images/user_add.png" />
			</div>

			<div class="button-bar">
				<idm:button action="#{roleList.initController}" value="#{msg['page.button.cancel']}"
					img="/resources/images/door_in.png" id="cancelRoleCreate" immediate="true" />

				<idm:button actionListener="#{roleEdit.save}" action="#{roleList.initController}" id="createRole"
					buttonType="positive" value="#{msg['page.button.save']}" img="/resources/images/user_add.png" />
			</div>
		</ice:form>
	</ui:define>
</ui:composition>