<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition template="/resources/templates/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ice="http://www.icesoft.com/icefaces/component"
	xmlns:idm="http://midpoint.evolveum.com/xml/ns/custom-taglib/">

	<ui:define name="title">#{msg['page.server.index.title']}</ui:define>

	<ui:define name="menu">
		<ui:include src="./menu.xhtml" />
	</ui:define>

	<ui:define name="content">
		<ice:form>
			<ui:remove>
				<ice:panelPopup modal="true" autoCentre="true"
					visible="#{resourceList.showPopup}">
					<f:facet name="header">
						<ice:outputText value="#{msg['Confirm delete']}" />
					</f:facet>
					<f:facet id="confirm" name="body">
						<ice:outputText value="#{msg['Delete selected resources?']}" />
						<div class="button-bar">
							<ice:commandButton id="deleteResourceYes" value="#{msg['Yes']}"
								action="#{resourceList.deleteResources}" />
							<ice:commandButton id="deleteResourceNo" value="#{msg['No']}"
								action="#{resourceList.hideConfirmDelete}" />
						</div>
					</f:facet>
				</ice:panelPopup>
			</ui:remove>
			<div class="button-bar">
				<idm:button value="List all tasks"
					img="/resources/images/application_view_list.png" id="allTasks"
					immediate="true" action="#{taskList.listFirst}" />
				<idm:button value="List currently executing tasks"
					img="/resources/images/application_view_list.png" id="runningTasks"
					immediate="true" action="#{taskList.listRunningTasks}" />
			</div>

			<p/>
			<ice:outputText value="Note: the following data reflects currently running task instances (i.e. those that have been assigned an execution thread on this node). The information presented" rendered="#{not taskList.listAll}" />
			<b><ice:outputText value="might be out of date and/or inaccurate" rendered="#{not taskList.listAll}" /></b>
			<ice:outputText value=". For more accurate information please select 'List all tasks' function." rendered="#{not taskList.listAll}" />
			
			<ice:dataTable id="taskTable" rows="50" value="#{taskList.objects}"
				var="item" columnClasses="iceDatTblCol1"
				rowClasses="iceDatTblRow1 iceDatTblRow2"
				columnWidths="auto, 250px, 180px, 150px, auto, auto, auto, auto" resizable="false">
				<ice:column>
					<f:facet name="header">
						<ice:selectBooleanCheckbox id="selectAllCheckbox"
							value="#{taskList.selectAll}"
							valueChangeListener="#{taskList.selectAllPerformed}"
							immediate="true" partialSubmit="true" />
					</f:facet>
					<ice:selectBooleanCheckbox id="selectCheckbox"
						value="#{item.selected}"
						valueChangeListener="#{taskList.selectPerformed}" immediate="true"
						partialSubmit="true" />
				</ice:column>

				<ice:column>
					<f:facet name="header">
						<ice:commandSortHeader columnName="name" arrow="true"
							actionListener="#{taskList.sortList}">
							<ice:outputText id="nameTxt" value="Name" />
						</ice:commandSortHeader>
					</f:facet>
					<ice:outputText>
						<ice:commandLink styleClass="iceOutTxt"
							style="text-decoration: underline;" id="name"
							value="#{item.name}" action="#{taskList.showTaskDetails}">
							<f:param name="taskOid" value="#{item.oid}" />
						</ice:commandLink>
					</ice:outputText>
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:commandSortHeader columnName="type" arrow="true"
							actionListener="#{taskList.sortList}">
							<ice:outputText id="bundleTxt" value="Handler" />
						</ice:commandSortHeader>
					</f:facet>
					<ice:outputText value="#{item.handlerUri}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:commandSortHeader columnName="version" arrow="true"
							actionListener="#{taskList.sortList}">
							<ice:outputText id="versionTxt" value="Object ref" />
						</ice:commandSortHeader>
					</f:facet>
					<ice:outputText value="#{item.objectRef}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:commandSortHeader columnName="execution" arrow="true"
							actionListener="#{taskList.sortList}">
							<ice:outputText id="executionTxt" value="Execution" />
						</ice:commandSortHeader>
					</f:facet>
					<ice:outputText value="#{item.executionStatus}" />
				</ice:column>

				<ice:column>
					<f:facet name="header">
						<ice:commandSortHeader columnName="thread" arrow="true"
							actionListener="#{taskList.sortList}">
							<ice:outputText id="threadTxt" value="Thread alive" />
						</ice:commandSortHeader>
					</f:facet>
					<ice:outputText value="#{item.aliveAsText}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:commandSortHeader columnName="running" arrow="true"
							actionListener="#{taskList.sortList}">
							<ice:outputText id="runningTxt" value="Current run time" />
						</ice:commandSortHeader>
					</f:facet>
					<ice:outputText value="#{item.currentRunTime}" />
				</ice:column>
				<ice:column>
					<f:facet name="header">
						<ice:commandSortHeader columnName="nextRun" arrow="true"
							actionListener="#{taskList.sortList}">
							<ice:outputText id="nextRunTxt" value="Scheduled to run again" />
						</ice:commandSortHeader>
					</f:facet>
					<ice:outputText value="#{item.startsAgainAfter}" />
				</ice:column>
			</ice:dataTable>

            <ice:outputText value="Scheduler thread running: " />
            <ice:outputText value="#{taskList.activated}" />
			<div class="button-bar">
				<idm:button value="Deactivate all execution threads"
					img="/resources/images/link_break.png"
					id="deactivateServiceThreads" immediate="true"
					action="#{taskList.deactivate}" />
				<idm:button value="Reactivate all execution threads" img="/resources/images/link_go.png"
					id="reactivateServiceThreads" immediate="true"
					action="#{taskList.reactivate}" />
			</div>
		</ice:form>
	</ui:define>
</ui:composition>