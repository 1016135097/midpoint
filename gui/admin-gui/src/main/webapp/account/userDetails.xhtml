<?xml version="1.0" encoding="UTF-8" ?>
<!-- Copyright (c) 2011 Evolveum                             -->
<!--                                                         -->
<!-- The contents of this file are subject to the terms      -->
<!-- of the Common Development and Distribution License      -->
<!-- (the License). You may not use this file except in      -->
<!-- compliance with the License.                            -->
<!--                                                         -->
<!-- You can obtain a copy of the License at                 -->
<!-- http://www.opensource.org/licenses/cddl1 or             -->
<!-- CDDLv1.0.txt file in the source code distribution.      -->
<!-- See the License for the specific language governing     -->
<!-- permission and limitations under the License.           -->
<!--                                                         -->
<!-- If applicable, add the following below the CDDL Header, -->
<!-- with the fields enclosed by brackets [] replaced by     -->
<!-- your own identifying information:                       -->
<!--                                                         -->
<!-- Portions Copyrighted 2011 [name of copyright owner]     -->
<!-- Portions Copyrighted 2011 lazyman					     -->
<!--                                                         -->
<ui:composition template="/resources/templates/template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:comp="http://java.sun.com/jsf/composite/components" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ice="http://www.icesoft.com/icefaces/component" xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:idm="http://midpoint.evolveum.com/xml/ns/custom-taglib/">

	<ui:define name="title">#{msg['page.account.detail.title']} '#{userDetails.user.fullName}'</ui:define>

	<ui:define name="menu">
		<ui:include src="./menu.xhtml" />
		<ui:include src="./menuDetails.xhtml" />
	</ui:define>

	<ui:define name="content">
		<comp:browser okAction="#{userDetails.assignmentEditor.okBrowseAction}"
			cancelAction="#{userDetails.assignmentEditor.cancelBrowseAction}"
			bean="#{userDetails.assignmentEditor.browser}" show="#{userDetails.assignmentEditor.showBrowser}" />
		<comp:xmlEditor okAction="#{userDetails.assignmentEditor.okEditorAction}"
			cancelAction="#{userDetails.assignmentEditor.cancelEditAction}"
			bean="#{userDetails.assignmentEditor.editor}" show="#{userDetails.assignmentEditor.showEditor}" />
			
		<ice:form id="admin-content">
			<ice:panelTabSet id="icePnlTbSet" style="width: 100%;" selectedIndex="#{userDetails.selectedTab}">
				<ice:panelTab id="userTab" label="#{msg['page.account.detail.tab.user.title']}"
					title="#{msg['page.account.detail.tab.user.description']}">
					<ice:panelGrid columns="2" cellpadding="7" cellspacing="7" id="userDetailsGrid">

						<ice:outputText value="#{msg['page.account.detail.tab.user.oid']}" />
						<ice:outputText id="oid" value="#{userDetails.user.oid}" />

						<ice:outputText value="#{msg['page.account.detail.tab.user.givenName']}" />
						<ice:outputText id="givenName" value="#{userDetails.user.givenName}" rendered="#{!userDetails.editMode}" />
						<ice:inputText id="givenNameText" value="#{userDetails.user.givenName}"
							rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['page.account.detail.tab.user.familyName']}" />
						<ice:outputText id="familyName" value="#{userDetails.user.familyName}"
							rendered="#{!userDetails.editMode}" />
						<ice:inputText id="familyNameText" value="#{userDetails.user.familyName}"
							rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['page.account.detail.tab.user.fullName']}" />
						<ice:outputText id="fullName" value="#{userDetails.user.fullName}" rendered="#{!userDetails.editMode}" />
						<ice:inputText id="fullNameText" value="#{userDetails.user.fullName}" rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['page.account.detail.tab.user.name']}" />
						<ice:outputText id="name" value="#{userDetails.user.name}" rendered="#{!userDetails.editMode}" />
						<ice:inputText id="nameText" value="#{userDetails.user.name}" rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['page.account.detail.tab.user.version']}" />
						<ice:outputText id="version" value="#{userDetails.user.version}" />

						<ice:outputLabel value="#{msg['page.account.detail.tab.user.email']}" />
						<ice:outputText id="email" rendered="#{!userDetails.editMode}" value="#{userDetails.user.email}" />
						<ice:inputText id="emailText" value="#{userDetails.user.email}" rendered="#{userDetails.editMode}" />

						<ice:outputLabel value="#{msg['page.account.detail.tab.user.locality']}" />
						<ice:outputText id="locality" rendered="#{!userDetails.editMode}" value="#{userDetails.user.locality}" />
						<ice:inputText id="localityText" value="#{userDetails.user.locality}" rendered="#{userDetails.editMode}" />

						<ice:outputLabel value="#{msg['page.account.detail.tab.user.password1']}"
							rendered="#{userDetails.editMode}" />
						<ice:panelGroup rendered="#{userDetails.editMode}">
							<ice:inputSecret id="password1" value="#{userDetails.user.password1}"
								requiredMessage="#{msg['field.required']}">
								<f:validator validatorId="PasswordValidator" />
								<f:attribute name="otherComponentId" value="password2" />
							</ice:inputSecret>
							<ice:message for="password1" errorClass="error" />
						</ice:panelGroup>

						<ice:outputLabel value="#{msg['page.account.detail.tab.user.password2']}"
							rendered="#{userDetails.editMode}" />
						<ice:panelGroup rendered="#{userDetails.editMode}">
							<ice:inputSecret id="password2" immediate="true" value="#{userDetails.user.password2}"
								requiredMessage="#{msg['field.required']}" />
							<ice:message for="password2" errorClass="error" />
						</ice:panelGroup>

						<ice:outputLabel value="#{msg['page.account.detail.tab.user.enabled']}" />
						<ice:panelGroup>
							<ice:selectBooleanCheckbox id="enabled"
								valueChangeListener="#{userDetails.changeActivationOfUserAccounts}" immediate="true"
								partialSubmit="true" value="#{userDetails.user.enabled}" required="true"
								requiredMessage="#{msg['field.required']}" readonly="#{not userDetails.editMode}"
								disabled="#{not userDetails.editMode}" />
							<ice:message for="enabled" errorClass="error" />
						</ice:panelGroup>

						<ice:outputLabel value="#{msg['page.account.detail.tab.user.webAccessEnabled']}" />
						<ice:panelGroup>
							<ice:selectBooleanCheckbox id="webAccessEnabled" value="#{userDetails.user.webAccessEnabled}"
								required="true" requiredMessage="#{msg['field.required']}" readonly="#{not userDetails.editMode}"
								disabled="#{not userDetails.editMode}" />
							<ice:message for="webAccessEnabled" errorClass="error" />
						</ice:panelGroup>

					</ice:panelGrid>
				</ice:panelTab>
				<ice:panelTab id="accountsTab" rendered="true" label="#{msg['page.account.detail.tab.accounts.title']}"
					icon="/resources/images/drive.png" title="#{msg['page.account.detail.tab.accounts.description']}">
					<ice:outputText style="margin-bottom: 10px; display: block;"
						value="#{msg['page.account.detail.tab.accounts.text']}" />
					<div>
						<span class="required-field" style="padding-right: 5px;">*</span>
						#{msg['page.account.detail.tab.accounts.required']}
					</div>
					<div>
						<br /> Note: Some of the values may be computed by (outbound) expressions in schema handling part of
						resource definition. Therefore form submission may be successful even if some mandatory values are not
						filled out. <br /> <br />
						<!-- <span class="expression-field" style="padding-right: 5px;">*</span>
						#{msg['page.account.detail.tab.accounts.filled']}-->
					</div>

					<c:forEach items="#{userDetails.accountList}" var="item" varStatus="status">
						<ice:panelGrid columns="3" style="width: 100%;"
							columnClasses="userDetailsResourceTableRow1, userDetailsResourceTableRow2">
							<ice:panelCollapsible expanded="#{item.expanded}">
								<f:facet name="header">
									<ice:outputText value="#{item.name}" />
								</f:facet>

								<ice:selectBooleanCheckbox value="#{item.bean.showingAllAttributes}" immediate="true"
									partialSubmit="true" disabled="true" />
								<ice:outputLabel value="Show all attributes" />
								<hr />
								<idm:autoForm bean="#{userDetails.formObjects}" index="#{status.index}"
									editable="#{userDetails.editMode}" />
								<hr />
								<comp:resourceCapability bean="#{item.resourceCapability}" editable="#{userDetails.editMode}" />
							</ice:panelCollapsible>
							<idm:button action="/account/userDetails" actionListener="#{userDetails.removeResourcePerformed}"
								value="#{msg['page.account.detail.tab.accounts.button.delete']}" buttonType="negative"
								immediate="true" img="/resources/images/drive_delete.png" rendered="#{userDetails.editMode}">
								<f:attribute name="beanId" value="#{item.id}" />
							</idm:button>
							<idm:button action="/account/userDetails" actionListener="#{userDetails.unlinkResourcePerformed}"
								value="#{msg['page.account.detail.tab.accounts.button.unlink']}" buttonType="negative"
								immediate="true" img="/resources/images/drive_go.png" rendered="#{userDetails.editMode}">
								<f:attribute name="beanId" value="#{item.id}" />
							</idm:button>
						</ice:panelGrid>
					</c:forEach>
					<br />
					<ice:panelGrid id="manageAccountList" columns="3" rendered="#{userDetails.editMode}">
						<ice:outputText value="#{msg['page.account.detail.tab.accounts.select']}" />
						<ice:selectManyListbox id="selectAccount" size="3" style="min-width: 200px; width: auto;"
							partialSubmit="true" value="#{userDetails.selectedResourceList}">
							<f:selectItems id="selectAccountItems" value="#{userDetails.availableResourceList}" />
						</ice:selectManyListbox>

						<idm:button id="addAccountButton" action="/account/userDetails"
							actionListener="#{userDetails.addResourcePerformed}"
							value="#{msg['page.account.detail.tab.accounts.button.add']}" buttonType="positive"
							img="/resources/images/drive_add.png" />
					</ice:panelGrid>
				</ice:panelTab>

				<ui:remove>
					<ice:panelTab label="#{msg['page.account.detail.tab.assignments.title']}"
						icon="/resources/images/report.png" title="#{msg['page.account.detail.tab.assignments.description']}">
						<!-- TODO: create this tab -->
					</ice:panelTab>
				</ui:remove>

				<ice:panelTab rendered="true" label="#{msg['page.account.detail.tab.roles.title']}"
					icon="/resources/images/folder_key.png" title="#{msg['page.account.detail.tab.roles.description']}">

					<ice:dataTable rows="20" value="#{userDetails.assignmentEditor.containsAssignment.assignments}"
						var="item" columnWidths="auto, auto, auto, auto, auto, auto, auto" resizable="false">
						<ice:column>
							<f:facet name="header">
								<ice:selectBooleanCheckbox id="selectAllCheckbox" value="#{userDetails.assignmentEditor.selectAll}"
									valueChangeListener="#{userDetails.assignmentEditor.selectAllPerformed}" immediate="true"
									partialSubmit="true" />
							</f:facet>
							<ice:selectBooleanCheckbox id="selectCheckbox" value="#{item.selected}" partialSubmit="true"
								immediate="true" valueChangeListener="#{userDetails.assignmentEditor.selectPerformed}" />
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="#{msg['page.role.roleEdit.table.assignmentType']}" />
							</f:facet>
							<ice:commandLink style="text-decoration: underline;" value="#{item.typeString}"
								action="#{userDetails.assignmentEditor.editAssignment}" rendered="#{not item.editing}"
								immediate="true">
								<f:param name="assignmentId" value="#{item.id}" />
							</ice:commandLink>
							<ice:selectOneMenu value="#{item.typeString}" rendered="#{item.editing}" immediate="true"
								partialSubmit="true">
								<f:selectItems value="#{userDetails.assignmentEditor.assignmentTypes}" />
							</ice:selectOneMenu>
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="#{msg['page.role.roleEdit.table.active']}" />
							</f:facet>
							<ice:selectBooleanCheckbox value="#{item.enabled}" disabled="#{not item.editing}" />
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="#{msg['page.role.roleEdit.table.object']}" />
							</f:facet>
							<ice:outputLabel value="#{item.objectString}" rendered="#{not item.editing}" />
							<ice:commandLink style="text-decoration: underline;" value="#{item.objectString}"
								action="#{userDetails.assignmentEditor.editAssignmentObject}" rendered="#{item.editing}"
								immediate="true">
								<f:param name="assignmentId" value="#{item.id}" />
							</ice:commandLink>
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="#{msg['page.role.roleEdit.table.useActivationDate']}" />
							</f:facet>
							<ice:selectBooleanCheckbox value="#{item.useActivationDate}" disabled="#{not item.editing}"
								immediate="true" partialSubmit="true" />
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="#{msg['page.role.roleEdit.table.activeFrom']}" />
							</f:facet>
							<ice:outputLabel value="#{item.fromActivationString}" rendered="#{not item.editing}" />
							<ice:selectInputDate value="#{item.fromActivation}" renderMonthAsDropdown="true" renderAsPopup="true"
								renderYearAsDropdown="true" renderWeekNumbers="true" rendered="#{item.editing}"
								renderInputField="true" singleSubmit="false" disabled="#{not item.useActivationDate}">
								<f:convertDateTime pattern="MMM/dd/yyyy hh:mm a" />
							</ice:selectInputDate>
						</ice:column>
						<ice:column>
							<f:facet name="header">
								<ice:outputLabel value="#{msg['page.role.roleEdit.table.activeTo']}" />
							</f:facet>
							<ice:outputLabel value="#{item.toActivationString}" rendered="#{not item.editing}" />
							<ice:selectInputDate value="#{item.toActivation}" renderMonthAsDropdown="true" renderAsPopup="true"
								renderYearAsDropdown="true" renderWeekNumbers="true" rendered="#{item.editing}"
								renderInputField="true" singleSubmit="false" disabled="#{not item.useActivationDate}">
								<f:convertDateTime pattern="MMM/dd/yyyy hh:mm a" />
							</ice:selectInputDate>
						</ice:column>
					</ice:dataTable>

					<div style="margin-bottom: 5px;">
						<idm:button action="#{userDetails.assignmentEditor.addAssignment}"
							value="#{msg['page.button.addAssignment']}" img="/resources/images/door_in.png" immediate="true"
							buttonType="positive" />

						<idm:button action="#{userDetails.assignmentEditor.deleteAssignments}" buttonType="negative"
							immediate="true" value="#{msg['page.button.deleteAssignments']}" img="/resources/images/user_add.png" />
					</div>
				</ice:panelTab>
			</ice:panelTabSet>

			<div class="button-bar">
				<idm:button action="#{userDetails.backPerformed}" value="#{msg['page.account.detail.button.back']}"
					img="/resources/images/door_in.png" />

				<idm:button actionListener="#{userDetails.startEditMode}"
					value="#{msg['page.account.detail.button.edit']}" id="editButton" img="/resources/images/user_edit.png"
					rendered="#{!userDetails.editMode}" immediate="true" action="/account/userDetails" />

				<idm:button action="#{userList.fillTableList}" actionListener="#{userDetails.savePerformed}"
					id="saveButton" buttonType="positive" value="#{msg['page.account.detail.button.save']}"
					img="/resources/images/user.png" rendered="#{userDetails.editMode}" />
			</div>
		</ice:form>
	</ui:define>
</ui:composition>