<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition template="/resources/templates/admin-template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:ice="http://www.icesoft.com/icefaces/component"
	xmlns:idm="http://midpoint.evolveum.com/xml/ns/custom-taglib/" xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="title">#{lang.messages['page.user.details.title']}</ui:define>

	<ui:define name="content-title">Details for user '#{userDetails.user.fullName}'</ui:define>

	<ui:define name="admin-content">
		<ice:form id="admin-content">
			<ice:panelGrid columns="2">
				<idm:button action="#{userDetails.backPerformed}" value="#{lang.messages['button.back']}"
					img="/resources/images/door_in.png" />

				<idm:button actionListener="#{userDetails.startEditMode}" value="Edit user" id="editButton"
					img="/resources/images/user_edit.png" rendered="#{!userDetails.editMode}" immediate="true"
					action="/account/detailUser" />

				<idm:button action="#{userList.fillTableList}" actionListener="#{userDetails.savePerformed}"
					id="saveButton" buttonType="positive" value="Save changes" img="/resources/images/user.png"
					rendered="#{userDetails.editMode}" />
			</ice:panelGrid>


			<ice:panelTabSet id="icePnlTbSet" style="width: 100%;" selectedIndex="#{userDetails.selectedTab}">

				<ice:panelTab label="User" title="User in repository">
					<ice:panelGrid columns="2" cellpadding="5px" border="0" style="font-size:14px;" id="detailUserPanelGrid">

						<ice:outputText value="#{msg['user.type.oid']}" />
						<ice:outputText id="oid" value="#{userDetails.user.oid}" />

						<ice:outputText value="#{msg['user.type.givenName']}" />
						<ice:outputText id="givenName" value="#{userDetails.user.givenName}" rendered="#{!userDetails.editMode}" />
						<ice:inputText id="givenNameText" value="#{userDetails.user.givenName}"
							rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['user.type.familyName']}" />
						<ice:outputText id="familyName" value="#{userDetails.user.familyName}"
							rendered="#{!userDetails.editMode}" />
						<ice:inputText id="familyNameText" value="#{userDetails.user.familyName}"
							rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['user.type.fullName']}" />
						<ice:outputText id="fullName" value="#{userDetails.user.fullName}" rendered="#{!userDetails.editMode}" />
						<ice:inputText id="fullNameText" value="#{userDetails.user.fullName}" rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['user.type.name']}" />
						<ice:outputText id="name" value="#{userDetails.user.name}" rendered="#{!userDetails.editMode}" />
						<ice:inputText id="nameText" value="#{userDetails.user.name}" rendered="#{userDetails.editMode}" />

						<ice:outputText value="#{msg['user.type.version']}" />
						<ice:outputText id="version" value="#{userDetails.user.version}" />

						<ice:outputLabel value="#{msg['user.type.email']}" />
						<ice:outputText id="email" rendered="#{!userDetails.editMode}" value="#{userDetails.user.email}" />
						<ice:inputText id="emailText" value="#{userDetails.user.email}" rendered="#{userDetails.editMode}" />

						<ice:outputLabel value="#{msg['user.type.locality']}" />
						<ice:outputText id="locality" rendered="#{!userDetails.editMode}" value="#{userDetails.user.locality}" />
						<ice:inputText id="localityText" value="#{userDetails.user.locality}" rendered="#{userDetails.editMode}" />


						<ice:outputLabel value="#{msg['user.type.password1']}" rendered="#{userDetails.editMode}" />
						<ice:panelGroup rendered="#{userDetails.editMode}">
							<ice:inputSecret id="password1" value="#{userDetails.user.password1}"
								requiredMessage="#{msg['field.required']}">
								<f:validator validatorId="PasswordValidator" />
								<f:attribute name="otherComponentId" value="password2" />
							</ice:inputSecret>
							<ice:message for="password1" errorClass="error" />
						</ice:panelGroup>

						<ice:outputLabel value="#{msg['user.type.password2']}" rendered="#{userDetails.editMode}" />
						<ice:panelGroup rendered="#{userDetails.editMode}">
							<ice:inputSecret id="password2" immediate="true" value="#{userDetails.user.password2}"
								requiredMessage="#{msg['field.required']}" />
							<ice:message for="password2" errorClass="error" />
						</ice:panelGroup>

						<ice:outputLabel value="#{msg['user.type.enabled']}" rendered="#{userDetails.editMode}" />
						<ice:panelGroup rendered="#{userDetails.editMode}">
							<ice:selectBooleanCheckbox id="enabled" value="#{userDetails.user.enabled}" required="true"
								requiredMessage="#{msg['field.required']}" />
							<ice:message for="enabled" errorClass="error" />
						</ice:panelGroup>

						<ice:outputLabel value="#{msg['user.type.webAccessEnabled']}" rendered="#{userDetails.editMode}" />
						<ice:panelGroup rendered="#{userDetails.editMode}">
							<ice:selectBooleanCheckbox id="webAccessEnabled" value="#{userDetails.user.webAccessEnabled}"
								required="true" requiredMessage="#{msg['field.required']}" />
							<ice:message for="webAccessEnabled" errorClass="error" />
						</ice:panelGroup>
					</ice:panelGrid>
				</ice:panelTab>
				<ice:panelTab rendered="true" label="Accounts" icon="resources/images/drive.png"
					title="Accounts on connected resources">
					<ice:outputText style="margin-bottom: 10px; display: block;"
						value="This tab shows user accounts on resources." />
					<div>
						<span class="required-field" style="padding-right: 5px;">*</span>Required field.
					</div>
					<div>
						<span class="expression-field" style="padding-right: 5px;">*</span>This field will be filled in with
						schema handling outbound expression.
					</div>

					<c:forEach items="#{userDetails.accountList}" var="item" varStatus="status">
						<ice:panelGrid columns="2" style="width: 100%;"
							columnClasses="userDetailsResourceTableRow1,userDetailsResourceTableRow2">
							<ice:panelCollapsible expanded="#{item.expanded}">
								<f:facet name="header">
									<ice:panelGroup>
										<ice:outputText value="#{item.name}" />
									</ice:panelGroup>
								</f:facet>

								<idm:autoForm bean="#{userDetails.formObjects}" index="#{status.index}"
									editable="#{userDetails.editMode}" />
							</ice:panelCollapsible>
							<idm:button action="/account/detailUser" actionListener="#{userDetails.removeResourcePerformed}"
								value="Delete account" buttonType="negative" immediate="true" img="/resources/images/drive_delete.png"
								rendered="#{userDetails.editMode}">
								<f:attribute name="beanId" value="#{item.id}" />
							</idm:button>
						</ice:panelGrid>
					</c:forEach>
					<br />
					<ice:panelGrid id="manageAccountList" columns="3" rendered="#{userDetails.editMode}">
						<ice:outputText value="Select resources: " />
						<ice:selectManyListbox id="selectAccount" size="3" style="min-width: 200px; width: auto;"
							partialSubmit="true" value="#{userDetails.selectedResourceList}">
							<f:selectItems id="selectAccountItems" value="#{userDetails.availableResourceList}" />
						</ice:selectManyListbox>

						<idm:button id="addAccountButton" action="/account/detailUser"
							actionListener="#{userDetails.addResourcePerformed}" value="Add account" buttonType="positive"
							img="/resources/images/drive_add.png" />
					</ice:panelGrid>
				</ice:panelTab>

				<ui:remove>
					<ice:panelTab rendered="true" label="Roles" icon="resources/images/folder_key.png" title="Roles">

					</ice:panelTab>
				</ui:remove>
			</ice:panelTabSet>
		</ice:form>
	</ui:define>
</ui:composition>